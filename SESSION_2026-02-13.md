# Session Summary - 2026-02-13

## 오늘 작업 내역

### 1. 대시보드 프롬프트 편집 기능 (commit: 7ee812b)

에이전트 모달에 **Prompt 탭** 추가 + 풀스크린 템플릿 편집 모달 구현.

**변경 파일:**
- `dashboard/serve.js` - 3개 API 엔드포인트 추가
  - `GET /api/templates` - 전체 템플릿 목록
  - `GET /api/templates/:name` - 템플릿 내용 읽기
  - `POST /api/templates/:name` - 템플릿 저장 + 백업 + 모든 프로젝트 자동 재생성
- `dashboard/dashboard.js` - 편집 UI (~150 lines 추가)
  - `showPromptEditor()` - 풀스크린 Markdown 편집 모달
  - `loadTemplate()` / `saveTemplate()` - API 통신
  - `markdownToHtml()` - 미리보기 (변수 `{{}}` 하이라이팅)
  - Prompt 탭 (에이전트 모달 내)
- `dashboard/styles.css` - 에디터 스타일 (다크테마, 모노스페이스)
- `dashboard/index.html` - Template Editor 모달 HTML

**로컬 사용법:**
```bash
cd C:\Users\dosik\.claude\agents\dashboard
node serve.js
# http://localhost:3456
# 프로젝트 선택 → 에이전트 클릭 → Prompt 탭 → Open Editor
# 편집 후 Save & Regenerate → 모든 프로젝트에 자동 반영
```

**안전장치:**
- 저장 전 `templates/.backups/` 에 자동 백업 생성
- 확인 다이얼로그 필수
- 디렉토리 트래버설 방어

---

### 2. Vercel 온라인 배포 (commits: a782b7f, 7c58a49)

대시보드를 Vercel에 배포하여 웹에서 접근 가능하도록 구현.

**라이브 URL:** https://agents-azure.vercel.app

**대체 URL:**
- https://agents-enmanys-projects.vercel.app
- https://agents-enmanyproject-enmanys-projects.vercel.app

**Vercel 프로젝트:**
- 이름: `agents`
- ID: `prj_VcBmmNHVdkIRMx1W2HokKp4XtrBR`
- 팀: `enmanys-projects` (`team_Y6jcC2OEqnkQIzwc5TzdUMjx`)

**추가된 파일:**
- `vercel.json` - 라우팅 설정 (정적 파일 rewrite + CORS)
- `package.json` - `@vercel/blob` 의존성
- `.vercelignore` - 불필요 파일 제외
- `api/projects.js` - 프로젝트 목록 API (서버리스)
- `api/templates/index.js` - 템플릿 목록 API (서버리스)
- `api/templates/[name].js` - 템플릿 CRUD (Vercel Blob 지원)

**스토리지:**
- **Vercel Blob Storage** 연결 완료
- `BLOB_READ_WRITE_TOKEN` 환경변수 설정됨
- 온라인 템플릿 읽기/쓰기 모두 검증 완료

**API 검증 결과:**
| 엔드포인트 | 상태 |
|---|---|
| `GET /` (대시보드) | 200 OK |
| `GET /api/projects` | 200 OK - 3개 프로젝트 |
| `GET /api/templates` | 200 OK - 16개 템플릿 |
| `GET /api/templates/정국-debug` | 200 OK - source: blob |
| `POST /api/templates/정국-debug` | 200 OK - blob 저장 성공 |
| `GET /data/registry.json` | 200 OK - rewrite 동작 |

---

## 현재 시스템 구조

```
C:\Users\dosik\.claude\agents\
├── vercel.json              # Vercel 라우팅
├── package.json             # @vercel/blob
├── .vercelignore            # 배포 제외 목록
├── registry.json            # 에이전트 메타데이터 (16개)
├── api/                     # Vercel 서버리스 함수
│   ├── projects.js
│   └── templates/
│       ├── index.js
│       └── [name].js        # Blob 읽기/쓰기
├── dashboard/               # 대시보드 UI
│   ├── index.html
│   ├── dashboard.js         # 프론트엔드 (~1250 lines)
│   ├── styles.css           # 다크테마 스타일
│   └── serve.js             # 로컬 서버 (포트 3456)
├── templates/               # 마스터 프롬프트 템플릿 (16개)
│   ├── 진-manager.md
│   ├── 정국-debug.md
│   ├── 지드래곤-fullstack.md
│   └── ... (13개 더)
├── scripts/
│   └── generate-agent.js    # 템플릿 → 프로젝트 파일 생성
└── scoring/                 # 에이전트 점수 데이터
```

---

### 3. 칸반보드 에이전트 카드 클릭 버그 수정 (commit: 7fbf45f)

칸반보드에서 에이전트 카드를 클릭해도 모달이 열리지 않는 버그 수정.

**원인**: `renderProjectView()`에서 칸반 카드를 새로 생성할 때 `initDragAndDrop()`만 호출하고, 클릭 이벤트를 바인딩하는 `bindKanbanCardEvents()`를 호출하지 않았음.

**수정**: `dashboard/dashboard.js:420` - `renderProjectView()` 끝에 `this.bindKanbanCardEvents()` 추가

추가 수정 (commit: cc05d69): `draggable="true"` 속성이 Chrome에서 `click` 이벤트를 차단하는 문제 → `mousedown`/`mouseup` 좌표 비교 방식으로 변경 (5px 이내 이동 = 클릭)

**재배포 완료**: Vercel 프로덕션 배포됨

---

### 4. agent-scores.json 404 스팸 수정 (commit: 1c9f1ac)

Vercel 환경에서 존재하지 않는 `agent-scores.json` 파일을 30초마다 반복 fetch하여 콘솔에 404 에러가 대량 발생하는 문제 수정.

**수정**: `loadProjectScores()`에서 `location.hostname`으로 환경 판별 → `localhost`에서만 파일 fetch 시도, Vercel에서는 바로 fallback 스코어 사용

---

## 다음 세션 체크리스트

### 확인할 것
- [x] https://agents-azure.vercel.app 접속하여 대시보드 UI 확인
- [x] 프로젝트 탭 클릭 (예: "청첩장 웹 애플리케이션")
- [x] 칸반보드에서 에이전트 카드 클릭 → 모달 열기 (버그 수정됨, mousedown/mouseup 방식)
- [x] 404 에러 스팸 해결 (Vercel 환경 감지)
- [ ] 에이전트 모달 → **Prompt** 탭 → **Open Editor** 버튼
- [ ] 풀스크린 편집기에서 템플릿 수정 → Save & Regenerate 테스트

### 남은 개선사항 (향후)
- [ ] **프로젝트별 오버라이드**: 특정 프로젝트만 다른 규칙 사용
- [ ] **고급 편집기**: Monaco Editor 통합 (문법 하이라이팅)
- [ ] **버전 관리**: Git 자동 커밋, 변경 이력 diff 보기
- [ ] **커스텀 도메인**: agents.yourdomain.com 설정
- [ ] **Blob → 로컬 동기화**: 온라인 편집 → 로컬 자동 반영 스크립트

### 재배포 방법
```bash
cd C:\Users\dosik\.claude\agents
vercel --yes --prod
```

### 로컬 서버 실행
```bash
cd C:\Users\dosik\.claude\agents\dashboard
node serve.js
# http://localhost:3456
```
